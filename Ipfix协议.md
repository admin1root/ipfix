# ipfix协议

IP数据流信息导出（IPFIX）协议，该协议用作在网络上传输流量信息的一种方式。 为了将数据流信息从输出过程传输到收集过程，需要流数据的通用表示形式以及传达它们的标准方法。 本文档描述了IPFIX数据和模板记录如何通过多种传输协议从IPFIX导出过程传送到IPFIX收集过程。

## 简介

数据网络上的流量可视为由流经网络元素的流组成。 出于管理或其他目的，访问有关通过网络元素的这些流的信息通常很有趣，有用，甚至必要。 收集过程应该能够接收通过数据网络内多个网络元素传递的流信息。 这要求在表示流信息的方法和将流从网络元件传递到收集点的手段上保持一致。 本文档指定了实现这些要求的协议。 本文档详细说明了不同流的表示形式，以及流解释，数据包格式，使用的传输机制，安全问题等所需的其他数据。

## 术语

#### Observation Point（观察点）
捕获IP报文的地方。具体到设备上，观测点可以指定到交换机或路由器的每个端口上。
每一个观察点都和一个观察域相关联，并且一个观察点可以是其他几个观察点的超集。例如，一个线卡接入点，是其他线卡接口观察点的超集。

#### Observation Domain（观察域）
观察域是数据流信息能被测定过程聚合的最大的观察点集合。每次输出过程输出的ipfix报文中，观察域的id都是唯一的。这样，收集过程可以通过观察域id确定一个观察域。

#### Packet Treatment（包处理）
包处理指转发设备或中间盒对包的处理。包括转发、丢弃或因为流量整理的延时。

#### Traffic Flow or Flow（流）
IPFIX对流的定义：在一定时间间隔内，经过观察点的一系列IP包。属于同一个流的IP包具有以下一些共同属性：
> 某些IP层头字段（例如目的IP地址）、传输层头字段（例如目的端口）、或应用层头字段（例如RTP头字段）
> 包自身的某些特征（例如MPLS标签号）
> 跟路由器对包处理方式相关字段（例如下一跳IP地址、输出接口）。

#### Flow Key（流键）
每个字段分别为：
> 属于数据包头（例如，目标IP地址）
> 是数据包本身的属性（例如，数据包长度）
> 继承自数据包处理（例如，自治系统（AS）数）

用来定义流（即对流中所有包都通用的属性）称为流键。例如由源IP、目的IP、源端口、目的端口、传输层协议构成的传统的“五元组”流键将属于单个通信方向的所有数据包组合到一个套接字上。

#### Flow Record（流记录）
一个流记录包含了一个观察点上的特定流的信息。流记录包含了流的测定属性（例如，流的字节总数）并且通常包含流的特征（例如，源IP地址）。

#### Metering Process（测定过程）
IP 数据流的解析处理过程，测定过程生成流记录。
计量过程由一组功能组成，这些功能包括数据包头捕获，时标技术，采样，分类和维护流记录。
流记录的维护可能包括创建新记录，更新现有记录，计算流统计信息，推导其他流属性，检测流到期，将流记录传递到导出过程以及删除流记录。

#### Exporting Process（输出过程）
发送IPFIX消息给收集过程。消息中的流记录是由一个或多个测定过程生成的。

#### Exporter（输出器）
承载一个或多个输出过程的设备称为输出器。

#### IPFIX Device（IPFIX设备）
IPFIX设备至少托管一个输出过程。 它可以承载进一步的输出过程以及任意数量的观察点和测定过程。

#### Collecting Process（收集过程）
收集过程从一个或多个导出过程接收IPFIX消息。 收集过程可能会处理或存储在这些消息中收到的流记录。

#### Collector（收集者）
承载一个或多个收集过程

#### Template（模板）
指定了需要从IPFIX设备传送到收集者的特定信息集的结构和语义，是一个<type, length>对的有序序列。每个模板都可以通过模板ID进行唯一标识。

#### IPFIX Message（IPFIX消息）
IPFIX消息由输出过程中生成，包含有该输出过程IPFIX记录，并被发送到收集过程。IPFIX消息封装在传输层。

#### Message Header（消息头）
提供IPFIX消息的基本信息：IPFIX版本，消息长度，消息序号等

#### Template Record（模板记录）
模板记录定义了数据记录中字段的结构和解释

#### Data Record（数据记录）
数据记录是包含与模板记录相对应的参数值的记录。

#### Options Template Record(选项模板记录)
选项模板记录是一种模板记录，它定义数据记录中字段的结构和解释，包括定义如何确定数据记录的适用范围。

#### Set(集)
有相同结构的记录的集合，有个头前缀。有三种set：
> Template Set：模板集是一个或多个在IPFIX消息中分组在一起的模板记录的集合。
> Options Template Set:选项模板集是一个或多个在IPFIX消息中分组在一起的选项模板记录的集合。
> Data Set:数据集是一个或多个相同类型的数据记录，它们在IPFIX消息中分组在一起。 每个数据记录都预先由模板记录或选项模板记录定义。

#### Information Element（信息元素）
信息元素是IPFIX记录中可能出现的与协议和编码无关的属性。 ~~信息元素在IANA“ IPFIX信息元素”注册表[IANA-IPFIX]中定义。 与信息元素关联的类型指示对其可能包含的内容的约束，并且还确定要在IPFIX中使用的有效编码机制。~~

#### Transport Session（传输会话）
在流控制传输协议（SCTP）中，传输会话称为SCTP关联，由SCTP端点唯一标识[RFC4960]； 在TCP中，传输会话称为TCP连接，由IP地址和所用TCP端口的组合唯一标识。 在UDP中，传输会话称为UDP会话，由IP地址和所用UDP端口的组合唯一标识。

### 术语汇总表
    +------------------+---------------------------------------------+
    |                  |                 Contents                    |
    |                  +--------------------+------------------------+
    |       Set        |      Template      |         Record         |
    +------------------+--------------------+------------------------+
    |     Data Set     |          /         |     Data Record(s)     |
    +------------------+--------------------+------------------------+
    |   Template Set   | Template Record(s) |           /            |
    +------------------+--------------------+------------------------+
    | Options Template |  Options Template  |           /            |
    |       Set        |      Record(s)     |                        |
    +------------------+--------------------+------------------------+
    
  
    
  数据集由数据记录组成。 不包括模板记录。 模板记录或选项模板记录定义了数据记录。

  模板集仅包含模板记录。

  选项模板集仅包含选项模板记录。
